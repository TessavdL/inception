# CMD ["nginx", "-g", "daemon off;"]

# nginx daemon off runs nginx in the foreground

# the default nginx daemon on will start nginx in the background
# this way nginx and other services are running and talking to each other
# one server runs many services

# with docker one container has only once service

# the initial process spawns a master nginx process and some workers and then immediately quits
# docker only watches the pid of the original command and therefore the container halts

# by turning off the daemon we keep the container running

# docker system prune -a
# cleans up any unused resources (images, volumes, containers) and networks

# docker ps
# shows all running containers

# docker images
# shows all images

# docker build -t "name_of_image" .

# docker run -it --name "name" -p 80:80 "name_of_image" bash
# will run the container in interactive mode so you can interact with it

# while the container is running you can use
# docker cp "name_of_container":"path_from_root_of_container" "path_host"
# to copy

# -rm removes container after it's done running

# to check if TSL 1.3 is enabled
# openssl s_client -connect localhost:443 -tls1_3

//////

# secure mysql installation
# https://stackoverflow.com/questions/24270733/automate-mysql-secure-installation-with-echo-command-via-a-shell-script

UPDATE mysql.user SET plugin = 'mysql_native_password', Password = PASSWORD('NEWPASSWORD') WHERE User = 'root';
mysql socket causes mariadb to ignore password
https://askubuntu.com/questions/766334/cant-login-as-mysql-user-root-from-normal-user-account-in-ubuntu-16-04

mysql -e "CREATE USER IF NOT EXISTS 'root'@'localhost' IDENTIFIED WITH auth_socket;"
mysql -e "CREATE USER 'root'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY '@DB_PASSWORD_ROOT';"
mysql -e "CREATE USER 'root'@'::1' IDENTIFIED WITH mysql_native_password BY '@DB_PASSWORD_ROOT';"

https://stackoverflow.com/questions/41846000/enable-password-and-unix-socket-authentication-for-mariadb-root-user

# COPY mysql_secure_installation.sql .
# ENV MARIADB_ROOT_PASSWORD=f3J9Qnb67hM0ff
# RUN sed -i 's@'\(\'root\'\)'@'\(\'"$MARIADB_ROOT_PASSWORD"\'\)'@g' mysql_secure_installation.sql
# RUN sed -i 's@MARIADB_ROOT_PASSWORD@"${MARIADB_ROOT_PASSWORD}"@g' mysql_secure_installation.sql
# RUN service mysql start && mysql -sf --user=root < mysql_secure_installation.sql

# select host, user, password, plugin from mysql.user;

mysql -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('123');FLUSH PRIVILEGES;" 
 printf "123\n n\n n\n n\n y\n y\n y\n" | mysql_secure_installation